{% extends "base.html" %}

{% block title %}All Hikes - Hike Guide{% endblock %}

{% block head %}
<style>
    .skeleton-pulse { animation: skeleton-fade 1.5s ease-in-out infinite; }
    @keyframes skeleton-fade { 0%,100%{opacity:0.6} 50%{opacity:1} }

    #filter-sidebar { max-height: calc(100vh - 140px); overflow-y: auto; }
    .filter-chip { display: inline-block; padding: 0.375rem 0.75rem; border-radius: 99px; font-size: 0.8125rem; font-weight: 500; border: 1px solid; cursor: pointer; transition: all 0.2s; }
    .filter-chip.inactive { background: white; color: #999; border-color: #e5e1da; }
    .filter-chip.inactive:hover { background: #f8faf7; color: #666; }
    .filter-chip.active { background: #2d7e41; color: white; border-color: #2d7e41; }

    .tree-sway   { animation: nat-sway 5s ease-in-out infinite; transform-origin: bottom center; }
    .tree-sway-2 { animation: nat-sway 4.5s ease-in-out infinite 1s; transform-origin: bottom center; }
    .bird-fly    { animation: nat-fly 8s ease-in-out infinite; }
    .bird-fly-2  { animation: nat-fly 6s ease-in-out infinite 1.2s; }
    .feather-drift { animation: nat-drift 5s ease-in-out infinite; }
    @keyframes nat-sway  { 0%,100%{transform:rotate(0deg)} 30%{transform:rotate(1.5deg)} 70%{transform:rotate(-1deg)} }
    @keyframes nat-fly   { 0%,100%{transform:translate(0,0)} 40%{transform:translate(12px,-7px)} 70%{transform:translate(24px,-3px)} }
    @keyframes nat-drift { 0%,100%{transform:translateY(0) rotate(0deg)} 50%{transform:translateY(6px) rotate(-12deg)} }
</style>
{% endblock %}

{% block content %}
<!-- Decorative background elements -->
<!-- Tall spruce left -->
<svg class="absolute -top-4 -left-24 w-20 h-52 text-forest-700/[0.06] tree-sway hidden lg:block pointer-events-none" viewBox="0 0 60 160" fill="currentColor">
    <polygon points="30,0 12,42 48,42"/>
    <polygon points="30,28 8,68 52,68"/>
    <polygon points="30,54 4,98 56,98"/>
    <polygon points="30,82 0,130 60,130"/>
    <rect x="25" y="128" width="10" height="32" rx="2"/>
</svg>
<!-- Shorter spruce right -->
<svg class="absolute top-12 -right-20 w-16 h-40 text-forest-700/[0.05] tree-sway-2 hidden lg:block pointer-events-none" viewBox="0 0 60 160" fill="currentColor">
    <polygon points="30,10 14,48 46,48"/>
    <polygon points="30,36 10,74 50,74"/>
    <polygon points="30,62 6,106 54,106"/>
    <polygon points="30,92 2,138 58,138"/>
    <rect x="25" y="136" width="10" height="24" rx="2"/>
</svg>
<!-- Two birds in flight -->
<svg class="absolute top-28 right-[28%] w-7 h-3.5 text-gray-500/25 bird-fly hidden lg:block pointer-events-none" viewBox="0 0 32 16" fill="currentColor">
    <path d="M16,8 C14,4 8,1 2,4 C6,6 10,6 16,8 Z"/>
    <path d="M16,8 C18,4 24,1 30,4 C26,6 22,6 16,8 Z"/>
</svg>
<svg class="absolute top-36 right-[24%] w-5 h-2.5 text-gray-500/15 bird-fly-2 hidden lg:block pointer-events-none" viewBox="0 0 32 16" fill="currentColor">
    <path d="M16,8 C14,4 8,1 2,4 C6,6 10,6 16,8 Z"/>
    <path d="M16,8 C18,4 24,1 30,4 C26,6 22,6 16,8 Z"/>
</svg>
<!-- Feather -->
<svg class="absolute bottom-[30%] left-[30%] w-4 h-9 text-amber-600/15 feather-drift hidden lg:block pointer-events-none" viewBox="0 0 20 48" fill="currentColor">
    <path d="M10,0 C10,0 18,8 18,20 C18,32 14,40 10,48 C10,48 10,40 8,32 C6,24 2,16 2,8 C2,4 6,0 10,0 Z"/>
    <line x1="10" y1="2" x2="10" y2="46" stroke="currentColor" stroke-width="0.8" opacity="0.4"/>
</svg>

<!-- Header -->
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8 relative z-10">
    <div>
        <h1 class="font-display text-3xl font-extrabold tracking-tight text-gray-900">All Hikes</h1>
        <p class="mt-1 text-sm text-gray-500">Browse trails, plan your next adventure</p>
    </div>
    <div class="flex items-center gap-2">
        <a href="/hikes/map"
           class="inline-flex items-center gap-1.5 rounded-xl bg-white px-4 py-2 text-sm font-semibold text-gray-600 ring-1 ring-sand-200 hover:bg-sand-50 transition-colors">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z"/></svg>
            Map
        </a>
        <a href="/hikes/new"
           class="inline-flex items-center gap-2 rounded-xl bg-forest-600 px-4 py-2 text-sm font-bold text-white shadow-sm hover:bg-forest-700 transition-colors">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
            Add Hike
        </a>
    </div>
</div>

<!-- Filters + Grid Container -->
<div class="lg:grid lg:grid-cols-5 lg:gap-6">
    <!-- Sidebar Filters (left, 1/5) -->
    <div class="lg:col-span-1 mb-6 lg:mb-0">
        <form id="filter-form" class="bg-white rounded-2xl ring-1 ring-sand-200 shadow-sm p-5" style="position: sticky; top: 80px;">
            <h2 class="font-display font-bold text-sm text-gray-900 mb-4">Filters</h2>

            <!-- Sort -->
            <div class="mb-5 pb-4 border-b border-sand-100">
                <label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-2">Sort</label>
                <select name="sort" id="sort-select" class="block w-full rounded-lg border-0 py-2 px-2.5 text-sm ring-1 ring-sand-300 focus:ring-2 focus:ring-forest-500 bg-white">
                    <option value="newest" {% if filters.sort == 'newest' %}selected{% endif %}>Newest</option>
                    <option value="distance" {% if filters.sort == 'distance' %}selected{% endif %}>Distance</option>
                    <option value="elevation" {% if filters.sort == 'elevation' %}selected{% endif %}>Elevation</option>
                </select>
            </div>

            <!-- Distance Range -->
            <div class="mb-5 pb-4 border-b border-sand-100">
                <label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-2">Distance</label>
                <div class="space-y-2">
                    <div>
                        <input type="range" name="min_distance" id="min-distance" min="0" max="100" value="{{ filters.min_distance }}" class="w-full">
                        <div class="text-xs text-gray-500">Min: <span id="min-distance-val">{{ filters.min_distance }}</span> km</div>
                    </div>
                    <div>
                        <input type="range" name="max_distance" id="max-distance" min="0" max="100" value="{{ filters.max_distance }}" class="w-full">
                        <div class="text-xs text-gray-500">Max: <span id="max-distance-val">{{ filters.max_distance }}</span> km</div>
                    </div>
                </div>
            </div>

            <!-- Elevation Gain Range -->
            <div class="mb-5 pb-4 border-b border-sand-100">
                <label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-2">Elevation</label>
                <div class="space-y-2">
                    <div>
                        <input type="range" name="min_elevation" id="min-elevation" min="0" max="3000" value="{{ filters.min_elevation }}" class="w-full">
                        <div class="text-xs text-gray-500">Min: <span id="min-elevation-val">{{ filters.min_elevation }}</span> m</div>
                    </div>
                    <div>
                        <input type="range" name="max_elevation" id="max-elevation" min="0" max="3000" value="{{ filters.max_elevation }}" class="w-full">
                        <div class="text-xs text-gray-500">Max: <span id="max-elevation-val">{{ filters.max_elevation }}</span> m</div>
                    </div>
                </div>
            </div>

            <!-- Country -->
            {% if all_countries %}
            <div class="mb-5 pb-4 border-b border-sand-100">
                <label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-2">Country</label>
                <select name="country" id="country-select" class="block w-full rounded-lg border-0 py-2 px-2.5 text-sm ring-1 ring-sand-300 focus:ring-2 focus:ring-forest-500 bg-white">
                    <option value="">All countries</option>
                    {% for c in all_countries %}
                    <option value="{{ c }}" {% if filters.country == c %}selected{% endif %}>{{ c }}</option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}

            <button type="submit" class="w-full rounded-lg bg-forest-600 px-3 py-2 text-sm font-bold text-white hover:bg-forest-700 transition-colors">Apply Filters</button>
        </form>
    </div>

    <!-- Grid (right, 4/5) -->
    <div class="lg:col-span-4">
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {% for hike in hikes %}
    <a href="/hikes/{{ hike.id }}" class="group block bg-white rounded-2xl overflow-hidden ring-1 ring-sand-200 shadow-sm hover:shadow-lg hover:ring-forest-300 transition-all duration-200">
        <!-- Map thumbnail with skeleton -->
        <div class="relative h-40 bg-sand-100 overflow-hidden">
            <!-- Skeleton pulse (shown until image loads) -->
            <div class="skeleton-pulse absolute inset-0 flex flex-col items-center justify-center gap-2">
                <div class="w-10 h-10 rounded-full bg-sand-200 animate-pulse"></div>
                <div class="w-20 h-2 rounded bg-sand-200 animate-pulse"></div>
                <div class="w-14 h-2 rounded bg-sand-200 animate-pulse"></div>
            </div>
            <img src="/hikes/mapy/static-map/{{ hike.id }}" alt="Map preview for {{ hike.title }}"
                 loading="lazy"
                 class="h-40 w-full object-cover transition-opacity duration-300 opacity-0"
                 onload="this.classList.remove('opacity-0'); this.classList.add('opacity-100'); this.previousElementSibling.remove();"
                 onerror="this.previousElementSibling.innerHTML='<svg class=\'w-10 h-10 text-sand-300\' fill=\'none\' viewBox=\'0 0 24 24\' stroke-width=\'1.5\' stroke=\'currentColor\'><path stroke-linecap=\'round\' stroke-linejoin=\'round\' d=\'M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z\'/></svg>'; this.remove();">
            <!-- Difficulty badge -->
            {% if hike.difficulty %}
            <span class="absolute top-3 right-3 inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-bold
                {% if hike.difficulty == 'Easy' %}bg-green-100 text-green-700
                {% elif hike.difficulty == 'Hard' %}bg-red-100 text-red-700
                {% else %}bg-amber-100 text-amber-700{% endif %}
                shadow-sm">
                {{ hike.difficulty }}
            </span>
            {% endif %}
        </div>
        <!-- Card body -->
        <div class="p-5">
            <div class="flex items-start justify-between gap-2">
                <h3 class="font-display font-bold text-lg text-gray-900 group-hover:text-forest-600 transition-colors leading-tight">{{ hike.title }}</h3>
            </div>
            {% if hike.start_name or hike.end_name %}
            <p class="mt-1 text-xs text-gray-400 truncate">
                {% if hike.start_name %}{{ hike.start_name }}{% endif %}{% if hike.start_name and hike.end_name %} â†’ {% endif %}{% if hike.end_name %}{{ hike.end_name }}{% endif %}
            </p>
            {% endif %}
            <div class="mt-2.5 flex items-center gap-3 text-sm text-gray-500">
                {% if hike.distance %}
                <span class="inline-flex items-center gap-1">
                    <svg class="w-4 h-4 text-forest-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.115 5.19l.319 1.913A6 6 0 008.11 10.36L9.75 12l-.387.775c-.217.433-.132.956.21 1.298l1.348 1.348c.21.21.329.497.329.795v1.089c0 .426.24.815.622 1.006l.153.076c.433.217.956.132 1.298-.21l.723-.723a8.7 8.7 0 002.288-4.042 1.087 1.087 0 00-.358-1.099l-1.33-1.108c-.251-.209-.553-.34-.874-.386l-1.532-.256a4 4 0 01-.837-.225L9.38 8.798a.75.75 0 01-.143-1.218l3.028-2.69a.75.75 0 01.587-.208l2.318.231a3.75 3.75 0 002.898-.91L19.5 2.85"/></svg>
                    {{ hike.distance }} km
                </span>
                {% endif %}
                {% if hike.elevation_gain %}
                <span class="inline-flex items-center gap-1">
                    <svg class="w-4 h-4 text-sand-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941"/></svg>
                    {{ hike.elevation_gain }}m
                </span>
                {% endif %}
            </div>
        </div>
    </a>
    {% else %}
    <!-- Empty state -->
    <div class="col-span-full flex flex-col items-center justify-center py-20 text-center">
        <svg class="w-12 h-12 text-sand-300 mb-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z"/></svg>
        <h3 class="font-display font-bold text-lg text-gray-900">No hikes yet</h3>
        <p class="mt-1 text-sm text-gray-500 max-w-sm">Start tracking your adventures by adding your first hike.</p>
        <a href="/hikes/new"
           class="mt-6 inline-flex items-center gap-2 rounded-xl bg-forest-600 px-5 py-2.5 text-sm font-bold text-white shadow-sm hover:bg-forest-700 transition-colors">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
            Add Your First Hike
        </a>
    </div>
        {% endfor %}
        </div>
    </div>
</div>

<script>
    const form = document.getElementById('filter-form');
    const minDistanceInput = form.querySelector('#min-distance');
    const maxDistanceInput = form.querySelector('#max-distance');
    const minElevationInput = form.querySelector('#min-elevation');
    const maxElevationInput = form.querySelector('#max-elevation');
    const sortSelect = form.querySelector('#sort-select');
    const countrySelect = form.querySelector('#country-select');

    // Range value display updates
    minDistanceInput.addEventListener('input', (e) => {
        document.getElementById('min-distance-val').textContent = e.target.value;
    });
    maxDistanceInput.addEventListener('input', (e) => {
        document.getElementById('max-distance-val').textContent = e.target.value;
    });
    minElevationInput.addEventListener('input', (e) => {
        document.getElementById('min-elevation-val').textContent = e.target.value;
    });
    maxElevationInput.addEventListener('input', (e) => {
        document.getElementById('max-elevation-val').textContent = e.target.value;
    });

    // Auto-submit on range changes
    [minDistanceInput, maxDistanceInput, minElevationInput, maxElevationInput, sortSelect, countrySelect].forEach(el => {
        if (el) el.addEventListener('change', () => form.submit());
    });
</script>
{% endblock %}