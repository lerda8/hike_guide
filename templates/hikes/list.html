{% extends "base.html" %}

{% block title %}All Hikes - Hike Guide{% endblock %}

{% block head %}
<style>
    .skeleton-pulse { animation: skeleton-fade 1.5s ease-in-out infinite; }
    @keyframes skeleton-fade { 0%,100%{opacity:0.6} 50%{opacity:1} }

    #filter-sidebar { max-height: calc(100vh - 140px); overflow-y: auto; }
    .filter-chip { display: inline-block; padding: 0.375rem 0.75rem; border-radius: 99px; font-size: 0.8125rem; font-weight: 500; border: 1px solid; cursor: pointer; transition: all 0.2s; }
    .filter-chip.inactive { background: white; color: #999; border-color: #e5e1da; }
    .filter-chip.inactive:hover { background: #f8faf7; color: #666; }
    .filter-chip.active { background: #2d7e41; color: white; border-color: #2d7e41; }

    .tree-sway { animation: tree-sway 4s ease-in-out infinite; }
    .tree-sway-2 { animation: tree-sway 3.5s ease-in-out infinite 0.3s; }
    .bird-fly { animation: bird-fly 6s ease-in-out infinite; }
    .feather-drift { animation: feather-drift 3s ease-in-out infinite; }
    @keyframes tree-sway { 0%, 100% { transform: translateX(0) scaleX(1); } 50% { transform: translateX(2px) scaleX(1); } }
    @keyframes bird-fly { 0%, 100% { transform: translateX(0) translateY(0); opacity: 0.3; } 50% { transform: translateX(15px) translateY(-8px); opacity: 0.6; } }
    @keyframes feather-drift { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(8px) rotate(-10deg); } }
</style>
{% endblock %}

{% block content %}
<!-- Decorative background elements -->
<svg class="absolute -top-32 -left-40 w-56 h-56 text-forest-200/15 tree-sway hidden lg:block pointer-events-none" viewBox="0 0 200 200" fill="currentColor">
    <!-- Large pine tree left -->
    <polygon points="100,15 30,85 170,85"/>
    <polygon points="100,50 25,120 175,120"/>
    <polygon points="100,90 10,170 190,170"/>
    <rect x="85" y="170" width="30" height="50" fill="currentColor" opacity="0.6"/>
</svg>

<svg class="absolute top-20 -right-32 w-48 h-48 text-forest-300/12 tree-sway-2 hidden lg:block pointer-events-none" viewBox="0 0 200 200" fill="currentColor">
    <!-- Medium pine tree right -->
    <polygon points="100,25 50,85 150,85"/>
    <polygon points="100,60 40,125 160,125"/>
    <polygon points="100,100 20,175 180,175"/>
    <rect x="85" y="175" width="30" height="45" fill="currentColor" opacity="0.5"/>
</svg>

<svg class="absolute top-32 right-1/4 w-5 h-5 text-amber-400/35 bird-fly hidden lg:block pointer-events-none" viewBox="0 0 24 24" fill="currentColor">
    <!-- Flying bird -->
    <path d="M12 2c-6 0-11 2-11 5 0 2 2 4 5 5-1 1-2 3-2 5 0 3 3 6 6 6s6-3 6-6c0-2-1-4-2-5 3-1 5-3 5-5 0-3-5-5-11-5z"/>
</svg>

<svg class="absolute bottom-1/3 left-1/3 w-3 h-5 text-amber-300/25 feather-drift hidden lg:block pointer-events-none" viewBox="0 0 24 24" fill="currentColor">
    <!-- Feather -->
    <path d="M6 2c0 0 0 4 2 8 2 4 4 8 8 12 0 0-2-4-4-8-2-4-6-12-6-12z"/>
</svg>

<!-- Header -->
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8 relative z-10">
    <div>
        <h1 class="font-display text-3xl font-extrabold tracking-tight text-gray-900">All Hikes</h1>
        <p class="mt-1 text-sm text-gray-500">Browse trails, plan your next adventure</p>
    </div>
    <div class="flex items-center gap-2">
        <a href="/hikes/map"
           class="inline-flex items-center gap-1.5 rounded-xl bg-white px-4 py-2 text-sm font-semibold text-gray-600 ring-1 ring-sand-200 hover:bg-sand-50 transition-colors">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z"/></svg>
            Map
        </a>
        <a href="/hikes/new"
           class="inline-flex items-center gap-2 rounded-xl bg-forest-600 px-4 py-2 text-sm font-bold text-white shadow-sm hover:bg-forest-700 transition-colors">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
            Add Hike
        </a>
    </div>
</div>

<!-- Filters + Grid Container -->
<div class="lg:grid lg:grid-cols-5 lg:gap-6">
    <!-- Sidebar Filters (left, 1/5) -->
    <div class="lg:col-span-1 mb-6 lg:mb-0">
        <form id="filter-form" class="bg-white rounded-2xl ring-1 ring-sand-200 shadow-sm p-5" style="position: sticky; top: 80px;">
            <h2 class="font-display font-bold text-sm text-gray-900 mb-4">Filters</h2>

            <!-- Sort -->
            <div class="mb-5 pb-4 border-b border-sand-100">
                <label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-2">Sort</label>
                <select name="sort" id="sort-select" class="block w-full rounded-lg border-0 py-2 px-2.5 text-sm ring-1 ring-sand-300 focus:ring-2 focus:ring-forest-500 bg-white">
                    <option value="newest" {% if filters.sort == 'newest' %}selected{% endif %}>Newest</option>
                    <option value="distance" {% if filters.sort == 'distance' %}selected{% endif %}>Distance</option>
                    <option value="elevation" {% if filters.sort == 'elevation' %}selected{% endif %}>Elevation</option>
                </select>
            </div>

            <!-- Distance Range -->
            <div class="mb-5 pb-4 border-b border-sand-100">
                <label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-2">Distance</label>
                <div class="space-y-2">
                    <div>
                        <input type="range" name="min_distance" id="min-distance" min="0" max="100" value="{{ filters.min_distance }}" class="w-full">
                        <div class="text-xs text-gray-500">Min: <span id="min-distance-val">{{ filters.min_distance }}</span> km</div>
                    </div>
                    <div>
                        <input type="range" name="max_distance" id="max-distance" min="0" max="100" value="{{ filters.max_distance }}" class="w-full">
                        <div class="text-xs text-gray-500">Max: <span id="max-distance-val">{{ filters.max_distance }}</span> km</div>
                    </div>
                </div>
            </div>

            <!-- Elevation Gain Range -->
            <div class="mb-5 pb-4 border-b border-sand-100">
                <label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-2">Elevation</label>
                <div class="space-y-2">
                    <div>
                        <input type="range" name="min_elevation" id="min-elevation" min="0" max="3000" value="{{ filters.min_elevation }}" class="w-full">
                        <div class="text-xs text-gray-500">Min: <span id="min-elevation-val">{{ filters.min_elevation }}</span> m</div>
                    </div>
                    <div>
                        <input type="range" name="max_elevation" id="max-elevation" min="0" max="3000" value="{{ filters.max_elevation }}" class="w-full">
                        <div class="text-xs text-gray-500">Max: <span id="max-elevation-val">{{ filters.max_elevation }}</span> m</div>
                    </div>
                </div>
            </div>

            <!-- Country -->
            {% if all_countries %}
            <div class="mb-5 pb-4 border-b border-sand-100">
                <label class="block text-xs font-bold text-gray-600 uppercase tracking-wide mb-2">Country</label>
                <select name="country" id="country-select" class="block w-full rounded-lg border-0 py-2 px-2.5 text-sm ring-1 ring-sand-300 focus:ring-2 focus:ring-forest-500 bg-white">
                    <option value="">All countries</option>
                    {% for c in all_countries %}
                    <option value="{{ c }}" {% if filters.country == c %}selected{% endif %}>{{ c }}</option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}

            <button type="submit" class="w-full rounded-lg bg-forest-600 px-3 py-2 text-sm font-bold text-white hover:bg-forest-700 transition-colors">Apply Filters</button>
        </form>
    </div>

    <!-- Grid (right, 4/5) -->
    <div class="lg:col-span-4">
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {% for hike in hikes %}
    <a href="/hikes/{{ hike.id }}" class="group block bg-white rounded-2xl overflow-hidden ring-1 ring-sand-200 shadow-sm hover:shadow-lg hover:ring-forest-300 transition-all duration-200">
        <!-- Map thumbnail with skeleton -->
        <div class="relative h-40 bg-sand-100 overflow-hidden">
            <!-- Skeleton pulse (shown until image loads) -->
            <div class="skeleton-pulse absolute inset-0 flex flex-col items-center justify-center gap-2">
                <div class="w-10 h-10 rounded-full bg-sand-200 animate-pulse"></div>
                <div class="w-20 h-2 rounded bg-sand-200 animate-pulse"></div>
                <div class="w-14 h-2 rounded bg-sand-200 animate-pulse"></div>
            </div>
            <img src="/hikes/mapy/static-map/{{ hike.id }}" alt="Map preview for {{ hike.title }}"
                 loading="lazy"
                 class="h-40 w-full object-cover transition-opacity duration-300 opacity-0"
                 onload="this.classList.remove('opacity-0'); this.classList.add('opacity-100'); this.previousElementSibling.remove();"
                 onerror="this.previousElementSibling.innerHTML='<svg class=\'w-10 h-10 text-sand-300\' fill=\'none\' viewBox=\'0 0 24 24\' stroke-width=\'1.5\' stroke=\'currentColor\'><path stroke-linecap=\'round\' stroke-linejoin=\'round\' d=\'M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z\'/></svg>'; this.remove();">
            <!-- Difficulty badge -->
            {% if hike.difficulty %}
            <span class="absolute top-3 right-3 inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-bold
                {% if hike.difficulty == 'Easy' %}bg-green-100 text-green-700
                {% elif hike.difficulty == 'Hard' %}bg-red-100 text-red-700
                {% else %}bg-amber-100 text-amber-700{% endif %}
                shadow-sm">
                {{ hike.difficulty }}
            </span>
            {% endif %}
        </div>
        <!-- Card body -->
        <div class="p-5">
            <div class="flex items-start justify-between gap-2">
                <h3 class="font-display font-bold text-lg text-gray-900 group-hover:text-forest-600 transition-colors leading-tight">{{ hike.title }}</h3>
            </div>
            {% if hike.start_name or hike.end_name %}
            <p class="mt-1 text-xs text-gray-400 truncate">
                {% if hike.start_name %}{{ hike.start_name }}{% endif %}{% if hike.start_name and hike.end_name %} â†’ {% endif %}{% if hike.end_name %}{{ hike.end_name }}{% endif %}
            </p>
            {% endif %}
            <div class="mt-2.5 flex items-center gap-3 text-sm text-gray-500">
                {% if hike.distance %}
                <span class="inline-flex items-center gap-1">
                    <svg class="w-4 h-4 text-forest-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.115 5.19l.319 1.913A6 6 0 008.11 10.36L9.75 12l-.387.775c-.217.433-.132.956.21 1.298l1.348 1.348c.21.21.329.497.329.795v1.089c0 .426.24.815.622 1.006l.153.076c.433.217.956.132 1.298-.21l.723-.723a8.7 8.7 0 002.288-4.042 1.087 1.087 0 00-.358-1.099l-1.33-1.108c-.251-.209-.553-.34-.874-.386l-1.532-.256a4 4 0 01-.837-.225L9.38 8.798a.75.75 0 01-.143-1.218l3.028-2.69a.75.75 0 01.587-.208l2.318.231a3.75 3.75 0 002.898-.91L19.5 2.85"/></svg>
                    {{ hike.distance }} km
                </span>
                {% endif %}
                {% if hike.elevation_gain %}
                <span class="inline-flex items-center gap-1">
                    <svg class="w-4 h-4 text-sand-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-5.94-2.28m5.94 2.28l-2.28 5.941"/></svg>
                    {{ hike.elevation_gain }}m
                </span>
                {% endif %}
            </div>
        </div>
    </a>
    {% else %}
    <!-- Empty state -->
    <div class="col-span-full flex flex-col items-center justify-center py-20 text-center">
        <svg class="w-12 h-12 text-sand-300 mb-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z"/></svg>
        <h3 class="font-display font-bold text-lg text-gray-900">No hikes yet</h3>
        <p class="mt-1 text-sm text-gray-500 max-w-sm">Start tracking your adventures by adding your first hike.</p>
        <a href="/hikes/new"
           class="mt-6 inline-flex items-center gap-2 rounded-xl bg-forest-600 px-5 py-2.5 text-sm font-bold text-white shadow-sm hover:bg-forest-700 transition-colors">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/></svg>
            Add Your First Hike
        </a>
    </div>
        {% endfor %}
        </div>
    </div>
</div>

<script>
    const form = document.getElementById('filter-form');
    const minDistanceInput = form.querySelector('#min-distance');
    const maxDistanceInput = form.querySelector('#max-distance');
    const minElevationInput = form.querySelector('#min-elevation');
    const maxElevationInput = form.querySelector('#max-elevation');
    const sortSelect = form.querySelector('#sort-select');
    const countrySelect = form.querySelector('#country-select');

    // Range value display updates
    minDistanceInput.addEventListener('input', (e) => {
        document.getElementById('min-distance-val').textContent = e.target.value;
    });
    maxDistanceInput.addEventListener('input', (e) => {
        document.getElementById('max-distance-val').textContent = e.target.value;
    });
    minElevationInput.addEventListener('input', (e) => {
        document.getElementById('min-elevation-val').textContent = e.target.value;
    });
    maxElevationInput.addEventListener('input', (e) => {
        document.getElementById('max-elevation-val').textContent = e.target.value;
    });

    // Auto-submit on range changes
    [minDistanceInput, maxDistanceInput, minElevationInput, maxElevationInput, sortSelect, countrySelect].forEach(el => {
        if (el) el.addEventListener('change', () => form.submit());
    });
</script>
{% endblock %}